var _Setting_=function(entity,divId){var setting=null;function setStates(item){entity.setState(item);setting.setState(item)}var _state=entity.state||{imgSrc:"",oldImgSrc:"",showImgUpload:false};var ImageComponent=React.createClass({displayName:"ImageComponent",getInitialState:function(){return _state},updateState:function(){this.setState(_state)},handleImgUploadClick:function(){_state.showImgUpload=true;this.setState(_state)},handleSaveClick:function(){entity.setState(_state)},render:function(){return React.createElement("div",{className:"container"},this.state.showImgUpload?React.createElement(UpImageComponent,{updateState:this.updateState}):"",React.createElement("div",{className:"warp-title"},"选择图片"),React.createElement("div",{className:"photos"},React.createElement("div",{className:"photo",onClick:this.handleImgUploadClick},React.createElement("div",{className:"pre background"},React.createElement("div",{className:"del",title:"删除"}),React.createElement("img",{id:"imgValue",src:this.state.imgSrc,alt:""}))),React.createElement("div",{className:"tip"},"文件大小小于200KB，支持jpg、png格式，建议jpg格式")),React.createElement("div",{className:"warp-border txc savebtn"},React.createElement("button",{id:"save",className:"btn btn-danger btn-sm",onClick:this.handleSaveClick},"保 存")))}});var UpImageComponent=React.createClass({displayName:"UpImageComponent",_file:null,option:{uploadBtnDisabled:true,imgSrc:""},getInitialState:function(){return this.option},handleCloseClick:function(){_state.showImgUpload=false;this.props.updateState()},handleCancelClick:function(){_state.showImgUpload=false;this.props.updateState()},handleFileChange:function(e){var file=e.target.files[0];var reader=new FileReader;var _this=this;if(file.type.match(/image*/)){reader.onload=function(e){_this.option.imgSrc=e.target.result;_this.setState(_this.option)};reader.readAsDataURL(file);this._file=file;this.option.uploadBtnDisabled=false;this.setState(this.option)}else{this.option.uploadBtnDisabled=true;this.option.imgSrc="";this.setState(this.option);alert("请上传图片!")}},handleUploadClick:function(e){var _this=this;if(!this._file){alert("请选择图片！");return}var formData=new FormData;var params={oldImgSrc:_state.oldImgSrc};for(var key in params){formData.append(key,params[key])}formData.append("imageFile",this._file);var xhr=new XMLHttpRequest;xhr.open("POST","/thumb/picupload",true);xhr.setRequestHeader("Content-Type","multipart/form-data;boundary=abc");xhr.onload=function(e){console.log(this.status);console.log(this.responseText);if(this.status==200){var rlt;try{rlt=eval("("+this.responseText+")")}catch(err){rlt={ResultCode:1,Message:"Eval object string error!"}}if(rlt.result=="OK"){alert("图片上传成功！")}else{alert(["错误: 接口失败"+rlt.message])}}else{alert("错误: Error:"+this.statusText)}};xhr.send(formData)},render:function(){return React.createElement("div",{className:"photoh5-overlay"},React.createElement("form",{name:"fileForm",method:"post",encType:"multipart/form-data"},React.createElement("div",{className:"photoh5"},React.createElement("div",{className:"ph5-warp ph5-title"},"添加图片",React.createElement("div",{className:"ph5-close",onClick:this.handleCloseClick})),React.createElement("div",{className:"ph5-body"},React.createElement("div",{className:"ph5-warp"},React.createElement("div",{className:"browse-file"},"选择图片",React.createElement("input",{type:"file",name:"imgFile",onChange:this.handleFileChange})),React.createElement("span",{className:"borwse-tip"},"文件大小需小于200K")),React.createElement("div",{className:"ph5-warp ph5-preview"},React.createElement("div",{className:"ph5-pre-jcrop"},React.createElement("div",{className:"ph5-pre-jcrop"},React.createElement("img",{alt:"",src:this.state.imgSrc})))),React.createElement("div",{className:"ph5-warp ph5-toolbar"},React.createElement("input",{type:"button",className:"ph5-upload",value:"上传",disabled:this.state.uploadBtnDisabled,onClick:this.handleUploadClick}),React.createElement("input",{type:"button",className:"ph5-cancel",value:"取消",onClick:this.handleCancelClick}))))))}});function render(){setting=ReactDOM.render(React.createElement(ImageComponent,null),document.getElementById(divId));return setting}return{setting:setting,setStates:setStates,render:render}};