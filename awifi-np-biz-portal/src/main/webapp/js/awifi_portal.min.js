/** @Copyright 爱WiFi TOE项目组 @version v2017-8-15 19:43:31 */
var indexApp=angular.module("indexApp",["ngRoute","ui.bootstrap","ngFileUpload"]);indexApp.run(function($rootScope,$cacheFactory){});indexApp.factory("sessionInjector",["$q",function($q){var responseInterceptor={response:function(response){var deferred=$q.defer();if(response.status=="200"){if(response.data&&typeof response.data==="string"&&response.data.match(/login\.min\.js/m)){window.top.location.href="/logout"}}deferred.resolve(response);return deferred.promise}};return responseInterceptor}]);indexApp.config(["$httpProvider",function($httpProvider){if(!$httpProvider.defaults.headers.get){$httpProvider.defaults.headers.get={}}$httpProvider.defaults.headers.get["Cache-Control"]="no-cache";$httpProvider.defaults.headers.get["Pragma"]="no-cache";$httpProvider.interceptors.push("sessionInjector")}]);indexApp.factory("init",function(){var resetWidth=function(){var h=$(".datacontent");var width=h.outerWidth(true);$(".listtitle").css("width",width)};return resetWidth});function getCurDate(){var date=new Date;var year=date.getFullYear();var month=date.getMonth()+1;var day=date.getDate();var curDate=year+"-"+(month<10?"0"+month:month)+"-"+(day<10?"0"+day:day);return curDate}function getEarlyOfMonth(){var date=new Date;var year=date.getFullYear();var month=date.getMonth()+1;var curDate=year+"-"+(month<10?"0"+month:month)+"-"+"01";return curDate}jQuery(function($){$.datepicker.regional["zh-CN"]={clearText:"清除",clearStatus:"清除已选日期",closeText:"关闭",closeStatus:"不改变当前选择",prevText:"<上月",prevStatus:"显示上月",prevBigText:"<<",prevBigStatus:"显示上一年",nextText:"下月>",nextStatus:"显示下月",nextBigText:">>",nextBigStatus:"显示下一年",currentText:"今天",currentStatus:"显示本月",monthNames:["一月","二月","三月","四月","五月","六月","七月","八月","九月","十月","十一月","十二月"],monthNamesShort:["一","二","三","四","五","六","七","八","九","十","十一","十二"],monthStatus:"选择月份",yearStatus:"选择年份",weekHeader:"周",weekStatus:"年内周次",dayNames:["星期日","星期一","星期二","星期三","星期四","星期五","星期六"],dayNamesShort:["周日","周一","周二","周三","周四","周五","周六"],dayNamesMin:["日","一","二","三","四","五","六"],dayStatus:"设置 DD 为一周起始",dateStatus:"选择 m月 d日, DD",dateFormat:"yy-mm-dd",firstDay:1,initStatus:"请选择日期",isRTL:false,changeYear:true,changeMonth:true};$.datepicker.setDefaults($.datepicker.regional["zh-CN"])});var jDialog={_onEnd:null,_canClose:true,_tmr:null,show:function(options){this.hide();var _this=this;var defaults={content:"",width:400,height:68,title:"提示",scroll:0,okButton:1,okLabel:"确定",cancelButton:0,cancelLabel:"取消",onBegin:function(){},onEnd:function(){},onOK:function(){return true},onCancel:function(){return true}};var opts=$.extend(defaults,options);if(!document.getElementById("jDialog")){$("body").append('<div id="jDialog_Overlay"></div><div id="jDialog"><div id="jDialog-Title" class="jDialog-Title"><span></span><a href="javascript:;"></a></div><div class="jDialog-Container"></div><div class="jDialog-Buttons"><span></span></div></div>')}else{$("#jDialog_Overlay").show();$("#jDialog").show()}if(typeof opts.onBegin=="function")opts.onBegin();this.onEnd=typeof opts.onEnd=="function"?opts.onEnd:null;if(!opts.okButton&&!opts.cancelButton)$("#jDialog .jDialog-Buttons").hide();$("#jDialog .jDialog-Title span").html(opts.title);$("#jDialog .jDialog-Title a").click(this.hide);$("#jDialog .jDialog-Container").height(opts.height).html(opts.content);if(opts.scroll)$("#jDialog .jDialog-Container").addClass("Scroll");if(this._canClose){if(opts.okButton)$("#jDialog .jDialog-Buttons").append('<button class="jDialog-OK">'+opts.okLabel+"</button>");if(opts.cancelButton)$("#jDialog .jDialog-Buttons").append('<button class="jDialog-Cancel">'+opts.cancelLabel+"</button>");if(opts.otherButton)$("#jDialog .jDialog-Buttons").append('<button class="jDialog-Other">'+opts.otherLabel+"</button>")}var winWidth=$(window).width(),winHeight=$(window).height(),titleHeight=$("#jDialog .jDialog-Title").outerHeight(),btnHeight=$("#jDialog .jDialog-Buttons").outerHeight(),scrollTop=$(window).scrollTop();$("#jDialog").css({width:opts.width,height:opts.height+titleHeight+btnHeight,left:(winWidth-opts.width)/2,top:(winHeight-opts.height-titleHeight-btnHeight)/2+scrollTop});$("#jDialog-Title a").click(function(){if(opts.onCancel())_this.hide()});$("#jDialog .jDialog-Buttons button:first").focus();$("#jDialog .jDialog-Buttons button.jDialog-OK").click(function(){if(opts.onOK())_this.hide()});$("#jDialog .jDialog-Buttons button.jDialog-Cancel").click(function(){if(opts.onCancel())_this.hide()})},addButton:function(btn,cls,fun){var _this=this;$("#jDialog .jDialog-Buttons").append('<button class="jDialog-'+cls+'">'+btn+"</button>");$("#jDialog .jDialog-Buttons button.jDialog-"+cls).click(function(){if(fun())_this.hide()})},message:function(str){clearTimeout(this._tmr);$("#jDialog .jDialog-Buttons span").html(str);this._tmr=setTimeout(function(){$("#jDialog .jDialog-Buttons span").html("")},5e3)},alert:function(title,str,fun){this.show({title:title,content:'<span class="jDialog-Text">'+str+"</span>"});if(typeof fun=="function")fun()},confirm:function(title,str,fun){this.show({title:title,content:'<span class="jDialog-Text">'+str+"</span>",cancelButton:1,onOK:fun})},openform:function(title,url,width,height,fun){this.show({title:title,scroll:1,content:'<div class="loading"></div>',width:width,height:height,cancelButton:1,onOK:fun});$.ajax({type:"GET",url:url,dataType:"html",success:function(data){$("#jDialog .jDialog-Container").html('<div class="winpage">'+data+"</div>")},error:function(){$("#jDialog .jDialog-Container").html('<div class="loadfailed">加载页面失败</div>')}})},openurl:function(title,url,width,height){this.show({title:title,scroll:1,content:'<div class="loading"></div>',width:width,height:height});$.ajax({type:"GET",url:url,dataType:"html",success:function(data){$("#jDialog .jDialog-Container").html('<div class="winpage">'+data+"</div>")},error:function(){$("#jDialog .jDialog-Container").html('<div class="loadfailed">加载页面失败</div>')}})},openhtmlform:function(title,htmlcode,width,height,fun){this.show({title:title,scroll:1,content:'<div class="winpage">'+htmlcode+"</div>",width:width,height:height,cancelButton:1,onOK:fun})},openhtml:function(title,htmlcode,width,height){this.show({title:title,scroll:1,content:'<div class="winpage">'+htmlcode+"</div>",width:width,height:height})},openhtmlcb:function(title,htmlcode,width,height){this.show({title:title,scroll:1,content:'<div class="winpage">'+htmlcode+"</div>",width:width,height:height,cancelButton:1,okButton:0})},hide:function(){if(this._canClose){$("#jDialog .jDialog-Container").html("").removeClass("Scroll");$("#jDialog .jDialog-Buttons").html("<span></span>");$("#jDialog").hide();$("#jDialog_Overlay").hide();if(typeof this.onEnd=="function")this.onEnd()}}};function initTips($obj,message){$obj.poshytip({content:message,className:"tip-yellow",showOn:"none",bgImageFrameSize:9,alignTo:"target",alignX:"inner-left",offsetX:0,offsetY:20});$obj.bind("focus",function(){hideTips($obj)})}function initTipsArray(objArray){var maxLength=objArray.length;for(var i=0;i<maxLength;i++){initTips(objArray[i])}}function showTips($obj){$obj.poshytip("show")}function updateShowTipos($obj,message){updateTips($obj,message);showTips($obj);setTimeout(function(){hideTips($obj)},3e3)}function hideTips($obj){$obj.poshytip("hide")}function updateTips($obj,message){$obj.poshytip("update",message)}function destroyTips($obj){$obj.poshytip("destroy")}function destroyTipsArray(objArray){var maxLength=objArray.length;for(var i=0;i<maxLength;i++){destroyTips(objArray[i])}}function loadingAppend(){$("body").append('<div class="loadingBody">'+'<div class="loadingBg"></div>'+'<div class="closeBtn">x</div>'+'<div class="loadingInfo">'+'<div class="imgInfo">'+'<img src="images/loading-wifi.gif" alt="">'+"</div>"+"</div>"+"</div>");var height=$(window).height();var imgHeight=$(".imgInfo").height();$(".imgInfo").css("margin-top",(height-imgHeight)/2);$(".closeBtn").on("click",function(e){loadingRemove()})}function loadingRemove(){$(".loadingBody").remove()}function resetWidth(){var h=$(".datacontent");var width=h.outerWidth(true);$(".listtitle").css("width",width)}function defaultIfEmpty(str,defaultStr){if(str===null||str===undefined)str=defaultStr;return str}function defaultString(str){if(str===null||str===undefined)str="";return str}function isBlank(str){if(str===null||str===undefined||$.trim(str)==="")return true;return false}function isNotBlank(str){if(str===null||str===undefined||$.trim(str)==="")return false;return true}function isNull(str){if(str===null||str===undefined)return true;return false}var defrules={customerName:"^[0-9a-zA-Z一-龥_]{1,20}$",account:"^[0-9a-zA-Z_]{4,20}$",contact:"^[a-zA-Z一-龥]{1,20}$",contactWay:"^(1[3|4|5|7|8][0-9][0-9]{8})?$",projectName:"^[0-9a-zA-Z一-龥_]{1,20}$",userName:"^[0-9a-zA-Z_]{1,20}$",cellphone:"^(1[3|4|5|7|8][0-9][0-9]{8})?$",realName:"^[a-zA-Z一-龥]{1,20}$",deptName:"^[0-9a-zA-Z一-龥]{1,20}$",domain:"^[a-z0-9]{1,}([-.]{1}[a-z0-9]{1,}){0,}[.]{1}[a-z]{1,4}$",email:"^[a-z0-9_.]{1,}@[a-z0-9]{1,}([-.]{1}[a-z0-9]{1,}){0,}[.]{1}[a-z]{1,4}$",password:"^[0-9a-zA-Z_一-龥]{4,20}$",chinese:"^[一-龥]{0,}$",wchars:"^[^\0-ÿ]{0,}$",phone:"^(([0-9]{3,4}[-]{1})?[0-9]{7,8})?$",zip:"^([1-9][0-9]{5})?$",integer:"^([-]?[0-9]+)?$",positiveInteger:"^(0|[1-9][0-9]*)$",number:"^([-]?[0-9]{1,}([.][0-9]{1,})?)?$",idcard:"^([1-9]{1}[0-9]{14}([0-9]{2}[0-9x])?)?$",industryName:"^[A-Za-z一-龥]{1,20}$",orderNo:"^[0-9]*$",atlas:"^[0-9a-zA-Z_一-龥]{1,50}$",contactPer:"^[a-zA-Z_一-龥]{1,50}$",componentName:"^[0-9a-zA-Z一-龥]{1,20}$",componentVersion:"[0-9a-zA-Z_]{1,20}$"};function chkString(str,pattern){var re=new RegExp(pattern,"gi");return re.test(str)}function checkLengthFail(str,length){if(str.length>length){return true}else{return false}}indexApp.controller("pageBarController",function($scope,pageService){});indexApp.factory("pageDao",function($http){var dao={};var optionType;var initPageNo=function($scope,pageNo,totalPage){var html="";html+="<ul>";if(pageNo!=1){html+='<li class="pre_page">上一页</li>'}var maxPreNo=5;var hasPreNo=totalPage>8&&pageNo>maxPreNo;var maxSuffixNo=totalPage-3;var hasSuffixNo=totalPage>8&&pageNo<maxSuffixNo;if(hasPreNo&&!hasSuffixNo){html+='<li class="page_one">1</li>';html+='<li id="pn-break">…</li>';var startIndex=totalPage-6;for(var i=startIndex;i<=totalPage;i++){if(i<=0)continue;html+="<li ";if(pageNo==i){html+='id="page_selected" '}html+='class="page_one">'+i+"</li>"}}else if(hasPreNo&&hasSuffixNo){html+='<li class="page_one">1</li>';html+='<li id="pn-break">…</li>';var startIndex=pageNo-3;var endIndex=pageNo+2;for(var i=startIndex;i<=endIndex;i++){if(i<=0)continue;html+="<li ";if(pageNo==i){html+='id="page_selected" '}html+='class="page_one">'+i+"</li>"}html+='<li id="pn-break">…</li>';html+='<li class="page_one">'+totalPage+"</li>"}else if(!hasPreNo&&hasSuffixNo){var maxSize=maxPreNo+2;for(var i=1;i<=maxSize;i++){html+="<li ";if(pageNo==i){html+='id="page_selected" '}html+='class="page_one">'+i+"</li>"}html+='<li id="pn-break">…</li>';html+='<li class="page_one">'+totalPage+"</li>"}else if(!hasPreNo&&!hasSuffixNo){for(var i=1;i<=totalPage;i++){html+="<li ";if(pageNo==i){html+='id="page_selected" '}html+='class="page_one">'+i+"</li>"}}var lastPageNo=totalPage-1;if(pageNo!=totalPage&&pageNo!=totalPage){html+='<li class="next_page">下一页</li>'}html+="</ul>";var $pageNoBar=$(".right_footer_page");$pageNoBar.empty().append(html)};var initPageNum=function(pageSize){$(".show_page").each(function(){var $this=$(this);var num=$this.attr("value");if(num==pageSize){$this.attr("id","page_selected")}})};var bindPageEvent=function($scope){var $pageNoBar=$(".right_footer_page");$pageNoBar.find(".pre_page").bind("click",function(){var $curPageNo=$pageNoBar.find("#page_selected");var $prevPageNo=$curPageNo.prev();var prePageNo=$prevPageNo.text();if(prePageNo==="上一页"){return}$curPageNo.attr("id","");$prevPageNo.attr("id","page_selected");optionType="pre_page";$scope.list();optionType=null});$pageNoBar.find(".page_one").bind("click",function(){$pageNoBar.find("#page_selected").attr("id","");var $this=$(this);$this.attr("id","page_selected");optionType="page_one";$scope.list();optionType=null});$pageNoBar.find(".next_page").bind("click",function(){var $curPageNo=$pageNoBar.find("#page_selected");var $nextPageNo=$curPageNo.next();var nextPageNo=$nextPageNo.text();if(nextPageNo==="下一页"){return}$curPageNo.attr("id","");$nextPageNo.attr("id","page_selected");optionType="next_page";$scope.list();optionType=null});var $pageNumBar=$(".page_num");var $show_page=$pageNumBar.find(".show_page");$show_page.off();$show_page.on("click",function(){$pageNumBar.find("#page_selected").attr("id","");var $this=$(this);$this.attr("id","page_selected");var paramKey="page.pageSize";var paramValue=$this.val();var url="/sysconfig/setvaluebykey?paramKey="+paramKey+"&paramValue="+paramValue;$http.get(url).success(function(data,status,headers,config){if(data.result=="FAIL"){jDialog.alert(data.message);return}$scope.list()}).error(function(data,status,headers,config){})})};dao.getPageNo=function(){if(!optionType){return 1}var pageNo=$('.right_footer_page  li[id="page_selected"]').text();if(pageNo===null||pageNo===undefined||$.trim(pageNo)===""){pageNo=1}return pageNo};dao.init=function($scope,data){var pageNo=data.pageNo;var totalPage=data.totalPage;var pageSize=data.pageSize;var totalRecord=data.totalRecord;$scope.showPageBar=totalRecord>0?true:false;initPageNo($scope,pageNo,totalPage);initPageNum(pageSize);bindPageEvent($scope)};return dao});indexApp.factory("pageService",function(pageDao){var service={};return service});indexApp.controller("leftMenuController",function($scope,leftMenuService){$scope.selectMenu=function($event){leftMenuService.selectMenu($event)};$scope.sysSet=function($event){leftMenuService.sysSet($event)};function initMenu(){$(".nav-title").click(function(){var that=$(this);var sub_ul=that.next("ul");var nav_item=that.parent(".nav-item");nav_item.siblings().find("ul").slideUp();sub_ul.slideToggle()});$(".nav-sub-title").click(function(){var that=$(this);var sub_ul=that.next("ul");var nav_item=that.parent("li");nav_item.siblings().find("ul").slideUp();sub_ul.slideToggle()});$(".header .header-user").on("click",function(e){e.stopPropagation();var $profile=$(".header-profile");if($profile.height()===0){$profile.css("height",$profile.find("ul").outerHeight());$(document).on("click",hideProfile)}else{$profile.css("height",0)}});$(window).on("resize",function(e){$(".main-layout").height($("body").height()-$(".header").height()-$(".nav-map").height())}).trigger("resize");$("[lhref]").on("click",function(e){});$(".header-profile").on("click","a",function(e){$(".header-profile").css("height",0);$(".active").removeClass("active")});$(".header-profile").on("mouseleave",function(e){$(this).css("height",0)})}var hideProfile=function(e){if($(e.target).parents(".header-profile").length===0){$(document).off("click",hideProfile);$(".header-profile").css("height",0)}};function init(){initMenu()}init()});indexApp.factory("leftMenuDao",function($http,$cacheFactory){var dao={};return dao});indexApp.factory("leftMenuService",function(leftMenuDao){var service={};service.initLeftMenu=function(){$("#project_menu").click(function(){$("#project_ul").toggle();if($("#project_ul").css("display")=="none"){$("#img01").attr("src","../../../../images/arrow_d.png")}else{$("#img01").attr("src","../../../../images/arrow_u.png")}})};service.selectMenu=function($event){var $choosed=$($event.target);$(".project_menu .menu_selected").removeClass("menu_selected");$choosed.addClass("menu_selected")};service.sysSet=function($even){$("#sys_ul").toggle();if($("#sys_ul").css("display")=="none"){$("#img02").attr("src","../../../../images/arrow_d.png")}else{$("#img02").attr("src","../../../../images/arrow_u.png")}};return service});indexApp.factory("topMenuDao",function($http){var dao={};dao.getCurUserName=function($scope){var url="/user/getcurusername";$http.get(url).success(function(data,status,headers,config){if(data.result=="FAIL"){jDialog.alert("提示: ",data.message);return}var userName=data.userName;if(isBlank(userName)){}$scope.userName=userName})};return dao});indexApp.controller("topMenuController",function($scope,topMenuService){topMenuService.getCurUserName($scope)});indexApp.factory("topMenuService",function(topMenuDao){var service={};service.getCurUserName=function($scope){topMenuDao.getCurUserName($scope)};return service});indexApp.controller("componentAddController",function($scope,componentService){function validateFail($scope){if(componentService.validateComponentNameFail($scope)){return true}if(componentService.validateVersionFail($scope)){return true}if(componentService.validateComponentPathFail()){return true}if(componentService.validateIconPathFail()){return true}if(componentService.validateThumbFail()){return true}return false}$scope.add=function(){if(validateFail($scope)){return}componentService.add($scope)};function init(){var component={};$scope.classifys=[{id:1,name:"通用"},{id:2,name:"认证组件"},{id:3,name:"过渡跳转组件"}];$scope.classify_id=1;$scope.canUniqueYes=false;$scope.component=component;componentService.initTips();componentService.projectSelect2($scope,"projectId");componentService.projectSelect2($scope,"filterProjectId")}init()});indexApp.controller("componentEditController",function($scope,$location,componentService){function validateFail($scope){if(componentService.validateComponentNameFail($scope)){return true}if(componentService.validateVersionFail($scope)){return true}if(componentService.validateComponentPathFailOfEdit()){return true}if(componentService.validateIconPathFailOfEdit()){return true}if(componentService.validateThumbFailOfEdit()){return true}return false}$scope.edit=function(){if(validateFail($scope)){return}componentService.edit($scope)};function init(){$scope.component={};var id=$location.search()["id"];componentService.show($scope,id);$scope.classifys=[{id:1,name:"通用"},{id:2,name:"认证组件"},{id:3,name:"过渡跳转组件"}];componentService.initTips();componentService.projectSelect2($scope,"projectId");componentService.projectSelect2($scope,"filterProjectId")}init()});indexApp.controller("componentListController",function($scope,componentService){function list(){componentService.list($scope)}$scope.list=list;list();$scope.delete=function(id){jDialog.confirm("组件管理",'<div class="rows"><label class="w100">您确定要删除该组件吗？</label></div>',function(){componentService.delete($scope,id);jDialog.hide()})};resetWidth()});indexApp.factory("componentDao",function($http,$location,pageDao){var dao={};dao.list=function($scope){loadingAppend();var pageNo=pageDao.getPageNo();var keywords=defaultString($scope.keywords);var url="/component/list?pageNo="+pageNo+"&keywords="+keywords;$http.get(url).success(function(data,status,headers,config){loadingRemove();if(data.result=="FAIL"){jDialog.alert("提示:",data.message);return}$scope.components=data.records;$scope.begin=data.begin;$scope.data=data;pageDao.init($scope,data)})};dao.add=function($scope){$("#btnAdd").attr("disabled",true);var canUnique=$("input[name='canUnique1']:checked").val();var projectIds=[];$("#projectIdSelect a").each(function(){projectIds.push($(this).attr("data-id"))});var filterProjectIdSelect=[];$("#filterProjectIdSelect a").each(function(){filterProjectIdSelect.push($(this).attr("data-id"))});var params={classify:$scope.classify_id,canUnique:canUnique,projectIds:projectIds.join(","),filterProjectIds:filterProjectIdSelect.join(",")};var url="/component/add?"+$.param(params);var options={url:url,type:"post",dataType:"json",clearForm:false,resetForm:false,beforeSubmit:function(){return true},success:function(data){if(data.result=="FAIL"){$("#btnAdd").attr("disabled",false);jDialog.alert("提示:",data.message);return}jDialog.alert("组件管理:","组件注册成功");$location.path("/component/list");$scope.$apply()}};$("#componentForm").ajaxSubmit(options)};dao.edit=function($scope){$("#btnEdit").attr("disabled",true);var projectIds=[];$("#projectIdSelect a").each(function(){projectIds.push($(this).attr("data-id"))});var filterProjectIdSelect=[];$("#filterProjectIdSelect a").each(function(){filterProjectIdSelect.push($(this).attr("data-id"))});var params={classify:$scope.component.classify,canUnique:$scope.component.canUnique,projectIds:projectIds.join(","),filterProjectIds:filterProjectIdSelect.join(",")};var url="/component/edit?"+$.param(params);var options={url:url,type:"post",dataType:"json",clearForm:false,resetForm:false,beforeSubmit:function(){return true},success:function(data){if(data.result=="FAIL"){$("#btnEdit").attr("disabled",false);jDialog.alert("提示:",data.message);return}jDialog.alert("组件管理:","组件编辑成功");$location.path("/component/list");$scope.$apply()}};$("#componentForm").ajaxSubmit(options)};dao.show=function($scope,id){var url="/component/show?id="+id;$http.get(url).success(function(resp,status,headers,config){if(resp.result=="FAIL"){jDialog.alert("提示:",resp.message);return}var _data=resp.data;$scope.component=_data;var projectIds=_data.projectIdsDsp.split(","),filterProjectIds=_data.filterProjectIdsDsp.split(","),projectNames=_data.projectNames.split(","),filterProjectNames=_data.filterProjectNames.split(",");global_projectIdSelected=projectIds;global_filterProjectIdSelected=filterProjectIds;var projectHtml=[],filterProjectHtml=[];for(var item in projectIds){if(projectIds[item]){projectHtml.push('<a href="javascript:;" data-index="1" data-id="'+projectIds[item]+'" data-text="'+projectNames[item]+'"><span>×</span>'+projectNames[item]+"</a>")}}$("#projectIdSelect").html(projectHtml.join(""));for(var item in filterProjectIds){if(filterProjectIds[item]){filterProjectHtml.push('<a href="javascript:;" data-index="2" data-id="'+filterProjectIds[item]+'" data-text="'+filterProjectNames[item]+'"><span>×</span>'+filterProjectNames[item]+"</a>")}}$("#filterProjectIdSelect").html(filterProjectHtml.join(""))})};dao.delete=function($scope,id){var url="/component/delete?id="+id;$http.get(url).success(function(data,status,headers,config){if(data.result=="FAIL"){jDialog.alert("提示:",data.message);return}jDialog.alert("组件管理:","组件删除成功");$scope.list()})};return dao});indexApp.factory("componentService",function($rootScope,componentDao,projectDao){var service={};service.list=function($scope){componentDao.list($scope)};service.validateComponentNameFail=function($scope){var $componentName=$("#componentName");var componentName=$scope.component.name;if(isBlank(componentName)){updateShowTipos($componentName,"组件名称不能为空！");return true}if(!chkString(componentName,defrules.componentName)){updateShowTipos($componentName,"组件名称的格式为：1-20位字母、数字、下划线组成，不含特殊字符");return true}return false};service.validateProjectNameFail=function($scope){var $fkProjectId=$("#fkProjectId");var fkProjectId=$scope.fkProjectId;if(isBlank(fkProjectId)){updateShowTipos($fkProjectId,"请选择项目");return true}return false};service.validateVersionFail=function($scope){var $version=$("#version");var version=$scope.component.version;if(isBlank(version)){updateShowTipos($version,"组件版本号不能为空！");return true}if(!chkString(version,defrules.componentVersion)){updateShowTipos($version,"组件版本号的格式为：1-20位字母、数字、下划线组成，不含特殊字符");return true}return false};service.validateComponentPathFail=function($scope){var $componentPath=$("#componentPath");var componentPath=$componentPath.val();if(isBlank(componentPath)){updateShowTipos($componentPath,"组件压缩包不能为空！");return true}if(componentPath.indexOf(".zip")==-1){updateShowTipos($componentPath,"组件压缩包格式不正确！");return true}return false};service.validateComponentPathFailOfEdit=function($scope){var $componentPath=$("#componentPath");var componentPath=$componentPath.val();if(isNotBlank(componentPath)&&componentPath.indexOf(".zip")==-1){updateShowTipos($componentPath,"组件压缩包格式不正确！");return true}return false};service.validateIconPathFail=function(){var $iconPath=$("#iconPath");var iconPath=$iconPath.val();if(isBlank(iconPath)){updateShowTipos($iconPath,"组件图标不能为空！");return true}if(iconPath.indexOf(".png")==-1){updateShowTipos($iconPath,"组件图标格式不正确！");return true}return false};service.validateIconPathFailOfEdit=function(){var $iconPath=$("#iconPath");var iconPath=$iconPath.val();if(isNotBlank(iconPath)&&iconPath.indexOf(".png")==-1){updateShowTipos($iconPath,"组件图标格式不正确！");return true}return false};service.validateThumbFail=function(){var $thumb=$("#thumb");var thumb=$thumb.val();if(isBlank(thumb)){updateShowTipos($thumb,"组件缩略图不能为空！");return true}var isPic=thumb.indexOf(".png")!=-1||thumb.indexOf(".jpg")!=-1;if(!isPic){updateShowTipos($thumb,"组件缩略图格式不正确！");return true}return false};service.validateThumbFailOfEdit=function(){var $thumb=$("#thumb");var thumb=$thumb.val();var isPic=thumb.indexOf(".png")!=-1||thumb.indexOf(".jpg")!=-1;if(isNotBlank(thumb)&&!isPic){updateShowTipos($thumb,"组件缩略图格式不正确！");return true}return false};service.initTips=function(){var $componentName=$("#componentName");var $fkProjectId=$("#fkProjectId");var $classify=$("#classify");var $version=$("#version");var $componentPath=$("#componentPath");var $iconPath=$("#iconPath");var $thumb=$("#thumb");var tipsArray=[$componentName,$fkProjectId,$classify,$version,$componentPath,$iconPath,$thumb,$iconPath];initTipsArray(tipsArray);$rootScope.$on("$locationChangeStart",function(){destroyTipsArray(tipsArray)})};service.add=function($scope){componentDao.add($scope)};service.show=function($scope,id){componentDao.show($scope,id)};service.edit=function($scope){componentDao.edit($scope)};service.delete=function($scope,id){componentDao.delete($scope,id)};service.projectSelect2=function($scope,idName){return projectDao.projectSelect2($scope,idName)};return service});indexApp.factory("templateDao",function($http,$location,pageDao){var dao={};dao.list=function($scope){loadingAppend();var pageNo=pageDao.getPageNo();var keywords=defaultString($scope.keywords);var projectId=$scope.projectId;var parentIndustryId=$scope.parentIndustryId;var childIndustryId=$scope.childIndustryId;if(isBlank(projectId)){projectId=""}if(isBlank(parentIndustryId)){parentIndustryId=""}if(isBlank(childIndustryId)){childIndustryId=""}var url="template/list?pageNo="+pageNo+"&keywords="+keywords+"&projectId="+projectId+"&primaryIndustry="+parentIndustryId+"&secondaryIndustry="+childIndustryId;$http.get(url).success(function(data){loadingRemove();if(data.result=="FAIL"){jDialog.alert("提示:",data.message);return}templates=data.records;_records=data.records;for(var i=0,len=_records.length;i<len;i++){var item=_records[i];item.thumb=item.thumb?item.thumb+"?_t"+(new Date).getTime():item.thumb}$scope.templates=_records;$scope.begin=data.begin;$scope.data=data;pageDao.init($scope,data)})};dao.delete=function($scope,id){var url="template/delete?id="+id;$http.get(url).success(function(data){if(data.result=="FAIL"){jDialog.alert("提示:",data.message);return}jDialog.alert("模板删除","删除成功!");$scope.list()})};dao.templateSync=function($scope,id){var url="/template/synsite?templateId="+id;$http.get(url).success(function(data){if(data.result=="FAIL"){jDialog.alert("提示:",data.message);return}jDialog.alert("模板同步","同步应用此模板的站点接口成功!");$scope.list()})};dao.copyTemplate=function($scope,id){var url="template/copy?templateId="+id;$http.get(url).success(function(data){if(data.result=="FAIL"){jDialog.alert("提示：",data.message);return}jDialog.alert("复制模板","模板复制成功");$scope.list()})};return dao});indexApp.controller("templateAddController",[],function($scope){});indexApp.controller("templateListController",function($scope,$modal,templateService,industryService,projectService){function list(){templateService.list($scope)}$scope.list=list;list();$scope.change=function($event){var industryId1=$scope.parentIndustryId;industryService.industry2List($scope,industryId1)};$scope.delete=function(id){jDialog.confirm("模板删除",'<div class="rows"><label class="w100">您确定要删除该模板吗？</label></div>',function(){templateService.delete($scope,id);jDialog.hide()})};$scope.templateSync=function(id){jDialog.confirm("模板同步",'<div class="rows"><label class="w100">您确定要同步应用此模板的站点吗？</label></div>',function(){templateService.templateSync($scope,id);jDialog.hide()})};$scope.copyTemplate=function(id){templateService.copyTemplate($scope,id)};function init(){industryService.industry1List($scope);projectService.projectSelect2("projectName")}init()});indexApp.factory("templateService",function($rootScope,templateDao){var service={};service.list=function($scope){templateDao.list($scope)};service.delete=function($scope,id){templateDao.delete($scope,id)};service.templateSync=templateDao.templateSync;service.copyTemplate=function($scope,id){templateDao.copyTemplate($scope,id)};return service});indexApp.controller("defaultSiteListController",function($scope,$modal,siteService){function list(){siteService.defaultList($scope)}$scope.list=list;list();$scope.delete=function(id){jDialog.confirm("默认站点删除",'<div class="rows"><label class="w100">您确定要删除该默认站点吗？</label></div>',function(){siteService.delete($scope,id);jDialog.hide()})}});indexApp.controller("siteListController",function($scope,$modal,customerService,siteService){function list(){siteService.list($scope)}$scope.list=list;list();$scope.delete=function(id){jDialog.confirm("站点删除",'<div class="rows"><label class="w100">您确定要删除该站点吗？</label></div>',function(){siteService.delete($scope,id);jDialog.hide()})};$scope.copySite=function(id){siteService.copySite($scope,id)};function init(){customerService.customerSelect2("customerIdAndLevel")}init()});indexApp.factory("siteDao",function($http,$location,pageDao){var dao={};dao.list=function($scope){loadingAppend();var pageNo=pageDao.getPageNo();var customerIdAndLevel=defaultString($scope.customerIdAndLevel);var customerIdAndLevelArray=customerIdAndLevel.split("#");var customerId=customerIdAndLevelArray[0];var cascadeLabel=customerIdAndLevelArray[1];if(isBlank(customerId)){customerId=""}if(isBlank(cascadeLabel)){cascadeLabel=""}var keywords=defaultString($scope.keywords);var templateName=defaultString($scope.templateName);var url="site/list?pageNo="+pageNo+"&customerId="+customerId+"&keywords="+keywords+"&templateName="+templateName;$http.get(url).success(function(data){loadingRemove();if(data.result=="FAIL"){jDialog.alert("提示:",data.message);return}sites=data.records;_records=data.records;for(var i=0,len=_records.length;i<len;i++){var item=_records[i];item.thumb=item.thumb?item.thumb+"?_t"+(new Date).getTime():item.thumb}$scope.sites=_records;$scope.begin=data.begin;$scope.data=data;pageDao.init($scope,data)})};dao.delete=function($scope,id){var url="site/delete?id="+id;$http.get(url).success(function(data){if(data.result=="FAIL"){jDialog.alert("提示:",data.message);return}jDialog.alert("站点删除","删除成功!");$scope.list()})};dao.defaultList=function($scope){loadingAppend();var pageNo=pageDao.getPageNo();var keywords=defaultString($scope.keywords);var url="site/defaultSite?pageNo="+pageNo+"&keywords="+keywords;$http.get(url).success(function(data){loadingRemove();if(data.result=="FAIL"){jDialog.alert("提示:",data.message);return}defaultSites=data.records;_records=data.records;for(var i=0,len=_records.length;i<len;i++){var item=_records[i];item.thumb=item.thumb?item.thumb+"?_t"+(new Date).getTime():item.thumb}$scope.defaultSites=_records;$scope.begin=data.begin;$scope.data=data;pageDao.init($scope,data)})};dao.copySite=function($scope,id){var url="site/copy?siteId="+id;$http.get(url).success(function(data){if(data.result=="FAIL"){jDialog.alert("提示：",data.message);return}jDialog.alert("复制站点","站点复制成功");$scope.list()})};return dao});indexApp.factory("siteService",function($rootScope,siteDao){var service={};service.list=function($scope){siteDao.list($scope)};service.delete=function($scope,id){siteDao.delete($scope,id)};service.defaultList=function($scope){siteDao.defaultList($scope)};service.copySite=function($scope,id){siteDao.copySite($scope,id)};return service});indexApp.factory("customerService",function($rootScope){var service={};service.customerSelect2=function(selectId){var ajaxUrl="/customer/optionsList";customerSelect(selectId,ajaxUrl)};function customerSelect(selectId,ajaxUrl){selectId=selectId||"customerSelect";return $("#"+selectId).select2({placeholder:"请选择客户",
allowClear:true,ajax:{url:ajaxUrl,dataType:"json",delay:0,data:function(params){return{keywords:params.term}},processResults:function(data,params){var _data=data.data;for(var i=0,len=_data.length;i<len;i++){var _item=_data[i];_item["id"]=_item.customerId+"#"+_item.cascadeLabel+"#"+_item.customerName;_item["text"]=_item.customerName}return{results:_data}},cache:true},escapeMarkup:function(markup){return markup},templateResult:function(data){if(data.loading)return"正在搜索...";var markup="<div>"+data.customerName+"</div>";return markup},templateSelection:function(data){return data.customerName||data.text}})}return service});indexApp.config(function($routeProvider,$httpProvider){$routeProvider.when("/",{templateUrl:"html/template/default.html"}).when("/component/list",{templateUrl:"html/template/portal/component/componentList.html",controller:"componentListController"}).when("/component/add",{templateUrl:"html/template/portal/component/componentAdd.html",controller:"componentAddController"}).when("/component/edit",{templateUrl:"html/template/portal/component/componentEdit.html",controller:"componentEditController"}).when("/site/list",{templateUrl:"html/template/portal/site/siteList.html",controller:"siteListController"}).when("/site/defaultSiteList",{templateUrl:"html/template/portal/site/defaultSiteList.html",controller:"defaultSiteListController"}).when("/template/list",{templateUrl:"html/template/portal/template/templateList.html",controller:"templateListController"}).when("/exceptionlog/list",{templateUrl:"html/template/log/exceptionlogList.html",controller:"exceptionlogListController"}).when("/sysconfig/list",{templateUrl:"html/template/system/sysConfigList.html",controller:"sysConfigController"}).when("/sysconfig/add",{templateUrl:"html/template/system/sysConfigAdd.html",controller:"sysConfigAddController"}).when("/sysconfig/edit",{templateUrl:"html/template/system/sysConfigEdit.html",controller:"sysConfigEditController"}).otherwise({redirectTo:"/"})});indexApp.controller("exceptionlogListController",function($scope,$modal,exceptionlogService){$scope.startDate="";$scope.endDate="";function list(){exceptionlogService.list($scope);initConditionForDate()}$scope.list=list;function initConditionForDate(){var $startDate=$("input[data-ng-model='startDate']");var $endDate=$("input[data-ng-model='endDate']");$startDate.datepicker({onSelect:function(dateText,inst){$endDate.datepicker("option","minDate",new Date(dateText.replace("-",",")));$scope.startDate=dateText}});$endDate.datepicker({onSelect:function(dateText,inst){$startDate.datepicker("option","maxDate",new Date(dateText.replace("-",",")));$scope.endDate=dateText}})}list();$scope.show=function(id){$scope.id=id;var modalInstance=$modal.open({templateUrl:"html/template/log/exceptionlogShow.html",controller:"exceptionlogShowController",size:"lg",scope:$scope});modalInstance.opened.then(function(){})};function resetWidth(){var h=$(".datacontent");var width=h.outerWidth(true);$(".listtitle").css("width",width)}resetWidth()});indexApp.controller("exceptionlogShowController",function($scope,exceptionlogService){var id=$scope.id;exceptionlogService.show($scope,id)});indexApp.controller("sysConfigAddController",function($scope,sysConfigService){$scope.add=function(){if(sysConfigService.paramValidateFail($scope))return;sysConfigService.add($scope)};function init(){$scope.sysconfig={};sysConfigService.initTips()}init()});indexApp.controller("sysConfigController",function(sysConfigService,$scope,$location,$modal){function list(){sysConfigService.list($scope)}$scope.list=list;list();$scope.show=function(id){$scope.id=id;var modalInstance=$modal.open({templateUrl:"html/template/system/sysConfigShow.html",controller:"sysConfigShowController",scope:$scope});modalInstance.opened.then(function(){})};$scope.delete=function(id){jDialog.confirm("删除参数配置",'<div class="rows"><label class="w100">您确定要删除该参数吗？</label></div>',function(){sysConfigService.remove($scope,id);jDialog.hide()})};function resetWidth(){var h=$(".datacontent");var width=h.outerWidth(true);$(".listtitle").css("width",width)}resetWidth()});indexApp.controller("sysConfigEditController",function($scope,$location,sysConfigService){$scope.edit=function edit(){if(sysConfigService.paramValidateFail($scope))return;sysConfigService.edit($scope)};function init(){var sysconfigId=$location.search()["sysconfigId"];sysConfigService.show($scope,sysconfigId);sysConfigService.initTips()}init()});indexApp.controller("sysConfigShowController",function($scope,sysConfigService){var id=$scope.id;sysConfigService.show($scope,id)});indexApp.factory("exceptionlogDao",function($http,pageDao){var dao={};dao.list=function($scope){var pageNo=pageDao.getPageNo();var startDate=$scope.startDate;var endDate=$scope.endDate;var keywords=defaultString($scope.keywords);var url="/exceptionlog/list?pageNo="+pageNo+"&startDate="+startDate+"&endDate="+endDate+"&keywords="+encodeURI(keywords);$http.get(url).success(function(data,status,headers,config){if(data.result=="FAIL"){jDialog.alert("提示: ",data.message);return}exceptionlogLists=data.records;$scope.exceptionlogs=data.records;$scope.begin=data.begin;$scope.data=data;pageDao.init($scope,data)}).error(function(data,status,headers,config){})};dao.show=function($scope,id){var url="/exceptionlog/show?id="+id;$http.get(url).success(function(data,status,headers,config){if(data.result=="FAIL"){jDialog.alert("提示: ",data.message);return}$scope.exceptionlog=data.data}).error(function(data,status,headers,config){jDialog.alert("提示: ",datastatus)})};return dao});indexApp.factory("sysConfigDao",function($http,$location,pageDao){var dao={};dao.list=function($scope){var pageNo=pageDao.getPageNo();var keywords=defaultString($scope.keywords);var url="/sysconfig/list?pageNo="+pageNo+"&keywords="+keywords;$http.get(url).success(function(data,status,headers,config){if(data.result=="FAIL"){jDialog.alert("提示: ",data.message);return}sysconfigs=data.records;$scope.sysconfigs=data.records;$scope.begin=data.begin;$scope.data=data;pageDao.init($scope,data)}).error(function(data,status,headers,config){})};dao.add=function($scope){var aliasName=$scope.sysconfig.aliasName;var paramKey=$scope.sysconfig.paramKey;var paramValue=$scope.sysconfig.paramValue;var remark=$scope.sysconfig.remark;if(isNull(remark)){remark=""}remark=encodeURIComponent(remark);var orderNo=$scope.sysconfig.orderNo;var url="/sysconfig/add?aliasName="+aliasName+"&paramKey="+paramKey+"&paramValue="+paramValue+"&remark="+remark+"&orderNo="+orderNo;$http.get(url).success(function(data,status,headers,config){if(data.result=="FAIL"){jDialog.alert("提示: ",data.message);return}jDialog.alert("系统参数配置","添加成功");$location.path("sysconfig/list")}).error(function(data,status,headers,config){jDialog.alert("提示: ",datastatus)})};dao.show=function($scope,id){var url="/sysconfig/getinfo?id="+id;$http.get(url).success(function(data,status,headers,config){if(data.result=="FAIL"){jDialog.alert("提示: ",data.message);return}$scope.sysconfig=data.data}).error(function(data,status,headers,config){jDialog.alert("提示: ",datastatus)})};dao.edit=function($scope){var id=$scope.sysconfig.id;var aliasName=$scope.sysconfig.aliasName;var paramKey=$scope.sysconfig.paramKey;var paramValue=$scope.sysconfig.paramValue;var remark=$scope.sysconfig.remark;if(isNull(remark)){remark=""}remark=encodeURIComponent(remark);var orderNo=$scope.sysconfig.orderNo;var url="/sysconfig/edit?id="+id+"&aliasName="+aliasName+"&paramKey="+paramKey+"&paramValue="+paramValue+"&remark="+remark+"&orderNo="+orderNo;$http.get(url).success(function(data,status,headers,config){if(data.result=="FAIL"){jDialog.alert("提示: ",data.message);return}jDialog.alert("系统参数配置","修改成功");$location.path("sysconfig/list")}).error(function(data,status,headers,config){jDialog.alert("提示: ",datastatus)})};dao.remove=function($scope,id){var url="/sysconfig/delete?id="+id;$http.get(url).success(function(data,status,headers,config){if(data.result=="FAIL"){jDialog.alert("提示: ",data.message);return}jDialog.alert("系统参数删除","删除成功");$scope.list()}).error(function(data,status,headers,config){jDialog.alert("提示: ",data.status)})};return dao});indexApp.factory("exceptionlogService",function(exceptionlogDao){var service={};service.list=function($scope){exceptionlogDao.list($scope)};service.show=function($scope,id){exceptionlogDao.show($scope,id)};return service});indexApp.factory("sysConfigService",function($rootScope,sysConfigDao){var service={};service.list=function($scope){sysConfigDao.list($scope)};service.add=function($scope){sysConfigDao.add($scope)};service.show=function($scope,id){sysConfigDao.show($scope,id)};service.edit=function($scope){sysConfigDao.edit($scope)};service.remove=function($scope,id){sysConfigDao.remove($scope,id)};service.paramValidateFail=function($scope){var $aliasName=$("input[data-ng-model='sysconfig.aliasName']");var aliasName=$scope.sysconfig.aliasName;if(isBlank(aliasName)){updateShowTipos($aliasName,"名称不能为空！");return true}var $paramKey=$("input[data-ng-model='sysconfig.paramKey']");var paramKey=$scope.sysconfig.paramKey;if(isBlank(paramKey)){updateShowTipos($paramKey,"Key不能为空！");return true}var $paramValue=$("input[data-ng-model='sysconfig.paramValue']");var paramValue=$scope.sysconfig.paramValue;if(isBlank(paramValue)){updateShowTipos($paramValue,"Value不能为空！");return true}var $orderNo=$("input[data-ng-model='sysconfig.orderNo']");var orderNo=$scope.sysconfig.orderNo;if(isBlank(orderNo)){updateShowTipos($orderNo,"排序号不能为空！");return true}if(!chkString(orderNo,defrules.orderNo)){updateShowTipos($orderNo,"排序号只能是数字形式!");return true}var $remark=$("textarea[data-ng-model='sysconfig.remark']");var remark=$scope.sysconfig.remark;if(isNotBlank(remark)&&checkLengthFail(remark,100)){updateShowTipos($remark,"备注长度不能超过100！");return true}return false};service.initTips=function(){initTips($("input[data-ng-model='sysconfig.aliasName']"));initTips($("input[data-ng-model='sysconfig.paramKey']"));initTips($("input[data-ng-model='sysconfig.paramValue']"));initTips($("input[data-ng-model='sysconfig.orderNo']"));initTips($("textarea[data-ng-model='project.remark']"));$rootScope.$on("$locationChangeStart",function(){destroyTips($("input[data-ng-model='sysconfig.aliasName']"));destroyTips($("input[data-ng-model='sysconfig.paramKey']"));destroyTips($("input[data-ng-model='sysconfig.paramValue']"));destroyTips($("input[data-ng-model='sysconfig.orderNo']"));destroyTips($("textarea[data-ng-model='project.remark']"))})};return service});indexApp.controller("PolicyAddController",function($scope){});indexApp.controller("PolicyController",function($scope){function resetWidth(){var h=$(".datacontent");var width=h.outerWidth(true);$(".listtitle").css("width",width)}resetWidth()});indexApp.factory("projectService",function($rootScope,$location){var service={};service.projectSelect2=function(selectId){selectId=selectId||"fkProjectId";var ajaxUrl="/project/projectList";return projectSelect(selectId,ajaxUrl)};function projectSelect(selectId,ajaxUrl){var userId=$location.search()["userId"];req_data={userId:userId};var $select=$("#"+selectId);var project_select=$select.select2({language:"zh-CN",placeholder:"请选择项目",allowClear:true,ajax:{url:ajaxUrl,dataType:"json",delay:0,data:function(params){return{keywords:params.term,userId:req_data.userId?req_data.userId:""}},processResults:function(data,params){var _data=data.data;for(var i=0,len=_data.length;i<len;i++){var _item=_data[i];_item["id"]=_item.projectId;_item["text"]=_item.projectName}return{results:_data}},cache:true},escapeMarkup:function(markup){return markup},templateResult:function(data){if(data.loading)return"正在搜索...";var markup="<div>"+data.projectName+"</div>";return markup},templateSelection:function(data){return data.projectName||data.text}});return project_select}return service});indexApp.factory("industryDao",function($http,$location,pageDao){var dao={};dao.industry1List=function($scope,parentId){parentId=defaultString(parentId);var url="/industry/list?parentId="+parentId;$http.get(url).success(function(data,status,headers,config){if(data.result=="FAIL"){jDialog.alert("提示",data.message);return}$scope.industry1s=data.data})};dao.industry2List=function($scope,industryId1){var url="/industry/list?parentId="+industryId1;$http.get(url).success(function(data,status,headers,config){if(data.result=="FAIL"){jDialog.alert("提示",data.message);return}$scope.industry2s=data.data})};return dao});indexApp.factory("locationDao",function($http,$location,pageDao){var dao={};dao.provinceList=function($scope){var url="/location/province";$http.get(url).success(function(data,status,headers,config){if(data.result=="FAIL"){jDialog.alert("提示",data.message);return}$scope.provinces=data.data})};dao.cityList=function($scope,provinceId){var url="/location/city?parentId="+provinceId;$http.get(url).success(function(data,status,headers,config){if(data.result=="FAIL"){jDialog.alert("提示",data.message);return}$scope.citys=data.data})};dao.countyList=function($scope,cityId){var url="/location/county?parentId="+cityId;$http.get(url).success(function(data,status,headers,config){if(data.result=="FAIL"){jDialog.alert("提示",data.message);return}$scope.countys=data.data})};return dao});var global_projectIdSelected=[],global_filterProjectIdSelected=[];indexApp.factory("projectDao",function($location){var dao={};dao.projectSelect2=function($scope,idName){idName=idName||"fkProjectId";var userId=$location.search()["userId"];var url="/project/projectList",req_data={userId:userId};var $select=$("#"+idName);var project_select=$select.select2({language:"zh-CN",placeholder:"请选择项目",ajax:{url:url,dataType:"json",delay:0,data:function(params){return{keywords:params.term,userId:req_data.userId?req_data.userId:""}},processResults:function(data,params){var _data=data.data;for(var i=0,len=_data.length;i<len;i++){var _item=_data[i];_item["id"]=_item.projectId;_item["text"]=_item.projectName}return{results:_data}},cache:true},escapeMarkup:function(markup){return markup},templateResult:function(data){if(data.loading)return"正在搜索...";var markup="<div>"+data.projectName+"</div>";return markup},templateSelection:function(data){return data.projectName||data.text}});project_select.on("select2:close",function(e){var target=e.target;var textContent="";var selectDivId=$(target).attr("id");var selectValue=target.value;if(selectValue.toString().indexOf("undefined")!=-1||selectValue==""){return}$(target).find("option").each(function(){var option_this=$(this);if(option_this.val()==selectValue){textContent=option_this.text();return}});var select2=$select.next(".select2-container");var $projectIdSelect=select2.next(".projectIdSelect");var $projectIdSelectA=$projectIdSelect.find("a");var hasItem=false;$projectIdSelectA.each(function(){var that=$(this);if(that.attr("data-id")==selectValue){that.remove();hasItem=true;if(selectDivId=="projectId"){global_projectIdSelected.splice($.inArray(selectValue,global_projectIdSelected),1)}if(selectDivId=="filterProjectId"){global_filterProjectIdSelected.splice($.inArray(selectValue,global_filterProjectIdSelected),1)}}});if(!hasItem){var addItem=false;if(selectDivId=="projectId"&&$.inArray(selectValue,global_filterProjectIdSelected)==-1){addItem=true}if(selectDivId=="filterProjectId"&&selectValue!="0"&&$.inArray(selectValue,global_projectIdSelected)==-1){addItem=true}if(addItem){var item='<a href="javascript:;" data-index="'+(selectDivId=="projectId"?"1":"2")+'" data-id="'+selectValue+'" data-text="'+textContent+'"><span>×</span>'+textContent+"</a>";$projectIdSelect.append(item);if(selectDivId=="projectId"){if($.inArray(selectValue,global_projectIdSelected)==-1){global_projectIdSelected.push(selectValue)}}if(selectDivId=="filterProjectId"){if($.inArray(selectValue,global_filterProjectIdSelected)==-1){global_filterProjectIdSelected.push(selectValue)}}}}$(target).html("");select2.find(".select2-selection__rendered").html('<span class="select2-selection__placeholder">请选择项目</span>')});$(document).on("click",".projectIdSelect a",function(){var that=$(this),projectIndex=that.attr("data-index"),value=that.attr("data-id");if(projectIndex=="1"){global_projectIdSelected.splice($.inArray(value,global_projectIdSelected),1)}else if(projectIndex=="2"){global_filterProjectIdSelected.splice($.inArray(value,global_filterProjectIdSelected),1)}$(this).remove()});return project_select};return dao});indexApp.factory("industryService",function($rootScope,industryDao){var service={};service.industry1List=function($scope){industryDao.industry1List($scope)};service.industry2List=function($scope,industryId1){$scope.industry2s="";if(isBlank(industryId1)){return}industryDao.industry2List($scope,industryId1)};return service});indexApp.factory("locationService",function($rootScope,locationDao){var service={};service.provinceList=function($scope){locationDao.provinceList($scope)};service.cityList=function($scope,provinceId){if(provinceId===null){$scope.citys="";$scope.countys="";return}locationDao.cityList($scope,provinceId)};service.countyList=function($scope,cityId){if(cityId===null){$scope.countys="";return}locationDao.countyList($scope,cityId)};return service});